name: TestBranchCreate
run-name: CreateTodayBranch ğŸš€
on: workflow_dispatch

jobs:
  MergeBranch:
    timeout-minutes: 1
    runs-on: ubuntu-22.04
    steps:
      - name: Check Out Repository
        uses: actions/checkout@v2
      - name: Get Date
        id: date
        run: |
          TODAY_BRANCH="dev-$(TZ=Asia/Tokyo date '+%m%d')"
          echo "::set-output name=branch_name::$TODAY_BRANCH"
        shell: bash
      - name: Check today Branch
        id: check_branch
        run: |
          if git show-ref --quiet "refs/heads/$(steps.check_branch.outputs.branch_name)"; then
            echo "Today Branch exists."
            echo "::set-output name=branch_exists::true"


            BASE_BRANCH="main"  # ä½œæˆå…ƒã®ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®š
            BRANCH_NAME=${{ steps.check_branch.outputs.branch_name }}

            echo $BRANCH_NAME

            # æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
            git checkout -b $BRANCH_NAME $BASE_BRANCH

            # æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥
            git push origin $BRANCH_NAME
          else
            echo "Branch $BRANCH_NAME does not exist."
            echo "::set-output name=branch_exists::false"

            BASE_BRANCH="master"  # ä½œæˆå…ƒã®ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®š

            # æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
            git checkout -b $BRANCH_NAME $BASE_BRANCH

            # æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥
            git push origin $BRANCH_NAME
          fi
        shell: bash
